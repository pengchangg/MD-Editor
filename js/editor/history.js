const HistoryModule={states:[],currentIndex:-1,maxStates:100,isUndoRedo:!1,lastState:null,init:function(){const t=window.AppElements.undoBtn,e=window.AppElements.redoBtn;t.addEventListener("click",this.undo.bind(this)),e.addEventListener("click",this.redo.bind(this)),this.updateButtons()},addState:function(t){this.isUndoRedo?this.isUndoRedo=!1:this.lastState!==t&&(this.lastState=t,this.currentIndex<this.states.length-1&&(this.states=this.states.slice(0,this.currentIndex+1)),this.states.push(t),this.states.length>this.maxStates?(this.states.shift(),this.currentIndex=Math.max(0,this.currentIndex-1)):this.currentIndex++,this.updateButtons(),console.log(`历史记录: 添加状态 #${this.currentIndex}, 总状态数: ${this.states.length}`))},undo:function(){if(this.currentIndex>0){this.currentIndex--,this.isUndoRedo=!0;const t=this.states[this.currentIndex];window.AppElements.editor.value=t,this.lastState=t,EditorModule.updatePreview(),EditorModule.updateEditorStatus(),LineNumbersModule.updateLineNumbers(),this.updateButtons(),console.log(`历史记录: 撤销到状态 #${this.currentIndex}`)}},redo:function(){if(this.currentIndex<this.states.length-1){this.currentIndex++,this.isUndoRedo=!0;const t=this.states[this.currentIndex];window.AppElements.editor.value=t,this.lastState=t,EditorModule.updatePreview(),EditorModule.updateEditorStatus(),LineNumbersModule.updateLineNumbers(),this.updateButtons(),console.log(`历史记录: 重做到状态 #${this.currentIndex}`)}},updateButtons:function(){window.AppElements.undoBtn.disabled=this.currentIndex<=0,window.AppElements.redoBtn.disabled=this.currentIndex>=this.states.length-1},clear:function(){this.states=[],this.currentIndex=-1,this.lastState=null,this.isUndoRedo=!1,this.updateButtons()},debugHistory:function(){console.log("历史记录状态:",{states:this.states.length,currentIndex:this.currentIndex,canUndo:this.currentIndex>0,canRedo:this.currentIndex<this.states.length-1})}};