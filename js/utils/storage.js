const Storage=function(){const t=document.getElementById("editor"),e=document.getElementById("save-btn"),a=document.getElementById("autosave-btn"),n=document.getElementById("save-status"),o=document.getElementById("autosave-status"),s=document.getElementById("storage-size");let i=null,d=!1;let l="";function c(){try{if(localStorage.setItem("md_editor_content",t.value),l=t.value,r("status-saved"),UIUtils.showNotification("notification-document-saved","success"),f(),"undefined"!=typeof ImageHandler)try{ImageHandler.cleanupUnusedImages(t.value),ImageHandler.validateImages()}catch(t){console.error("处理图片数据时出错:",t),UIUtils.showNotification("notification-image-processing-failed","warning")}return!0}catch(t){return console.error("保存到localStorage失败:",t),UIUtils.showNotification("notification-save-failed","error"),!1}}function u(){t.value!==l?r("status-unsaved"):r("status-saved")}function r(t){let e=t;"undefined"!=typeof LanguageModule&&LanguageModule.getTranslation&&(e=LanguageModule.getTranslation(t)),n.textContent=e,"status-saved"===t?(n.classList.remove("unsaved"),n.classList.add("saved")):"status-unsaved"===t?(n.classList.remove("saved"),n.classList.add("unsaved")):"status-loaded"===t&&(n.classList.remove("unsaved"),n.classList.add("loaded"))}function v(){d=!d,localStorage.setItem("md_editor_autosave",d),d?(g(),UIUtils.showNotification("notification-autosave-enabled","info")):(i&&(clearInterval(i),i=null),UIUtils.showNotification("notification-autosave-disabled","info")),m()}function g(){i&&clearInterval(i),i=setInterval((()=>{if(t.value!==l){c()&&UIUtils.showNotification("notification-document-autosaved","info")}}),3e4)}function m(){o.textContent=d?"开启":"关闭",d?a.classList.add("active"):a.classList.remove("active")}function f(){const e=(t.value||"").length;let a=0;for(let t=0;t<localStorage.length;t++){const e=localStorage.key(t);"md_editor_content"!==e&&(a+=(localStorage.getItem(e)||"").length)}const n=((e+a)/1024).toFixed(2),o=(n/1024).toFixed(2);let i="";i=o>=1?`${o} MB`:`${n} KB`,s.textContent=i}return{init:function(){!function(){const e=localStorage.getItem("md_editor_content");e&&(t.value=e,l=e,r("status-loaded"),setTimeout((()=>{r("status-saved")}),2e3),"undefined"!=typeof ImageHandler&&setTimeout((()=>{ImageHandler.validateImages()}),500))}(),function(){const t=localStorage.getItem("md_editor_autosave");d="true"===t,m(),d&&g()}(),e.addEventListener("click",c),a.addEventListener("click",v),t.addEventListener("input",u),f()},saveContent:c,updateStorageInfo:f}}();document.addEventListener("DOMContentLoaded",(function(){Storage.init()}));